### æ¦‚è¦
Windows ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—å‘ã‘ã«å†è¨­è¨ˆã—ãŸã€Œå°±æ´»ç®¡ç†ã‚¢ãƒ—ãƒªã€ã®è©³ç´°è¨­è¨ˆã‚’æç¤ºã—ã¾ã™ã€‚å‰æï¼šPCï¼ˆWindowsï¼‰ãƒã‚¤ãƒ†ã‚£ãƒ–ä½“é¨“ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚‚ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œå¯èƒ½ã€ãƒªãƒã‚¤ãƒ³ãƒ‰ã¯ Slack é€šçŸ¥ã§è¡Œã†ã€‚MVP ã‹ã‚‰æ‹¡å¼µã¾ã§å®Ÿå‹™ã§å®Ÿè£…ã—ã‚„ã™ã„æ§‹æˆã«ã—ã¦ã„ã¾ã™ã€‚

---

### æ¨å¥¨æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã¨ç†ç”±
- UI å®Ÿè£…ï¼ˆæ¨å¥¨ï¼‰ï¼šElectron + Reactï¼ˆTypeScriptï¼‰  
  - ç†ç”±ï¼šWeb æŠ€è¡“ã§ UI é–‹ç™ºãŒé€Ÿãã€æ—¢å­˜ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼/ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä½¿ãˆã€Windows é…å¸ƒï¼ˆMSIX/EXEï¼‰å¯¾å¿œãŒå®¹æ˜“ã€‚å°†æ¥ macOS ã¸ç§»æ¤å¯ã€‚
- ä»£æ›¿ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ï¼‰ï¼š.NET 7 + WinUI 3 (C#)  
  - ç†ç”±ï¼šãƒã‚¤ãƒ†ã‚£ãƒ–ã®é«˜æ€§èƒ½ãƒ»Windows UX ã«æœ€é©ã€‚ç¤¾å†… Windows ç’°å¢ƒå‘ã‘ã§å®‰å®šæ€§é‡è¦–ãªã‚‰ã“ã¡ã‚‰ã€‚
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆä»»æ„ã€ã‚¯ãƒ©ã‚¦ãƒ‰ or è‡ªãƒ›ã‚¹ãƒˆï¼‰
  - Node.js + Express / NestJSï¼ˆTypeScriptï¼‰ ã¾ãŸã¯ ASP.NET Coreï¼ˆC#ï¼‰
  - ç†ç”±ï¼šèªè¨¼ã€ãƒãƒ«ãƒãƒ‡ãƒã‚¤ã‚¹åŒæœŸã€Slack é€šçŸ¥é€ä¿¡ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æ‹…ã†
- ãƒ­ãƒ¼ã‚«ãƒ« DBï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰ï¼šSQLiteï¼ˆElectron/NET åŒæ–¹ã§å®¹æ˜“ï¼‰  
- ã‚¯ãƒ©ã‚¦ãƒ‰ DBï¼ˆä»»æ„åŒæœŸï¼‰ï¼šPostgreSQL
- ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ï¼šãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼‹ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸæ™‚ã¯ S3 äº’æ›
- Slack é€šçŸ¥ï¼šSlack Incoming Webhooks ã¾ãŸã¯ Slack API (OAuth + chat.postMessage)
- é…å¸ƒï¼šMSIX / Windows Installerï¼ˆElectron-builder ã¾ãŸã¯ MSIX packaging for WinUIï¼‰
- CI/CDï¼šGitHub Actionsï¼ˆãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ç”Ÿæˆï¼‰

---

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆé«˜ãƒ¬ãƒ™ãƒ«ï¼‰
- ã‚¢ãƒ—ãƒªå±¤ï¼ˆClientï¼‰
  - UIï¼ˆReactï¼‰ï¼‹ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆSQLiteã‚¢ã‚¯ã‚»ã‚¹, ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
  - é€šä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼šãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åŒæœŸ API ã¨ Slack é€šçŸ¥ã®é€ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå‘¼ã³å‡ºã—
  - ãƒ­ãƒ¼ã‚«ãƒ«é€šçŸ¥ï¼ˆãƒˆãƒ¼ã‚¹ãƒˆï¼‰ã¯è£œåŠ©çš„ã«æä¾›å¯èƒ½ã ãŒ ãƒªãƒã‚¤ãƒ³ãƒ‰ã¯ Slack ã§å®Ÿæ–½
- ã‚µãƒ¼ãƒãƒ¼å±¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - èªè¨¼ã€ãƒãƒ«ãƒç«¯æœ«åŒæœŸã€é›†ä¸­ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€Slack é€šçŸ¥ä¸­ç¶™ï¼ˆWebhook ã®ä¿è­·ï¼‰ã€å…±æœ‰æ©Ÿèƒ½
- ãƒãƒƒãƒï¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
  - ãƒ­ãƒ¼ã‚«ãƒ«ï¼šã‚¢ãƒ—ãƒªèµ·å‹•ä¸­ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ï¼ˆnode-cron ç›¸å½“ï¼‰ãŒ notifications ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç›£è¦–
  - ã‚µãƒ¼ãƒãƒ¼ï¼šCloud Scheduler/cron ãŒé€šçŸ¥ã‚’é€ã‚‹ï¼ˆå¸¸ã«ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ç¢ºå®Ÿã«é€ã‚‹å ´åˆï¼‰
- ãƒ‡ãƒ¼ã‚¿åŒæœŸ
  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å„ªå…ˆï¼šãƒ­ãƒ¼ã‚«ãƒ«ã§æ“ä½œ â†’ ãƒ­ãƒ¼ã‚«ãƒ« DB â†’ åŒæœŸã‚­ãƒ¥ãƒ¼ â†’ ã‚µãƒ¼ãƒãƒ¼ã«é †æ¬¡åŒæœŸï¼ˆè¡çªè§£æ±ºã¯æœ€çµ‚æ›´æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰

---

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆSQLite / PostgreSQL å…±é€šï¼‰ â€” ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«
- users
  - id, name, email, slack_user_id (nullable), created_at, updated_at, settings (json)
- companies
  - id, user_id, name, industry, size, url, status, memo, created_at, updated_at
- events
  - id, user_id, company_id (nullable), title, description, start_at (UTC), end_at (UTC), all_day (bool), location, type, remind_before_minutes (int), slack_notify (bool), created_at, updated_at
- es_entries
  - id, user_id, company_id (nullable), title, content (richtext), attachments (json array), status, created_at, updated_at
- self_analyses
  - id, user_id, title, content, tags (json array), linked_companies (json array), created_at, updated_at
- interview_notes
  - id, user_id, company_id, date, qa_list (json), score, next_action, created_at, updated_at
- notifications
  - id, user_id, event_id (nullable), scheduled_at (UTC), sent_at (nullable), status (pending/sent/failed), channel (slack/local), payload (json)
- sync_queue (ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨)
  - id, entity_type, entity_id, op (create/update/delete), payload, status, attempts, last_attempt_at

---

### API / å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- ãƒ­ãƒ¼ã‚«ãƒ«å†…éƒ¨ APIï¼ˆElectron IPC / .NET ã‚µãƒ¼ãƒ“ã‚¹ï¼‰  
  - getCompanies(userId)  
  - getCompany(id)  
  - upsertCompany(payload)  
  - deleteCompany(id)  
  - getEvents(start,end) â€” ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨  
  - upsertEvent(payload) â€” ã“ã“ã§ notifications ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ  
  - scheduleNotification(notificationId)  
  - sendSlackNotification(notificationId)  
  - getES(userId, companyId?) / upsertES / deleteES  
  - getSelfAnalyses / upsert / delete
- ã‚µãƒ¼ãƒãƒ¼ APIï¼ˆåŒæœŸãƒ»å…±æœ‰ç”¨ï¼‰
  - POST /sync â€” ãƒãƒƒãƒåŒæœŸï¼ˆå·®åˆ†ï¼‰  
  - POST /notifications/dispatch â€” ã‚µãƒ¼ãƒãƒ¼å´é€šçŸ¥é€ä¿¡ï¼ˆå¿…è¦æ™‚ï¼‰

---

### UI/UXï¼ˆç”»é¢ä¸€è¦§ã¨ä¸»è¦è¦ç´ ï¼‰
1. èµ·å‹• / ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
   - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ or OAuthï¼ˆGoogle/Microsoftï¼‰ï¼‹ Slack é€£æºï¼ˆSlack OAuth ã§ workspace ã¨é€£æºã—é€šçŸ¥æ¨©é™ã‚’ä»˜ä¸ï¼‰
2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆãƒ›ãƒ¼ãƒ ï¼‰
   - æ¤œç´¢ãƒãƒ¼ã€ä»Šæ—¥ã®ç· åˆ‡æ•°ã€æ¬¡ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã€ä¼æ¥­ãƒªã‚¹ãƒˆï¼ˆãƒ•ã‚£ãƒ«ã‚¿ï¼šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼‰
   - ä¸­å¤®ï¼šæœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆã€ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ï¼‰
   - å³ï¼šè¿‘æ—¥ã®é€šçŸ¥ï¼ˆé€ä¿¡æ¸ˆ/ä¿ç•™/å¤±æ•—ï¼‰
3. ä¼æ¥­ãƒšãƒ¼ã‚¸
   - ãƒ˜ãƒƒãƒ€ï¼šä¼æ¥­åã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ãƒœã‚¿ãƒ³ã€ãƒªãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³
   - ã‚¿ãƒ–ï¼šæ¦‚è¦ï¼ã‚¤ãƒ™ãƒ³ãƒˆï¼ESï¼é¢æ¥ãƒãƒ¼ãƒˆï¼ãƒ¡ãƒ¢
4. ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆä¼æ¥­ãƒšãƒ¼ã‚¸ or ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ï¼‰
   - å…¥åŠ›é …ç›®ï¼šã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¿ã‚¤ãƒ—ã€è©³ç´°ã€é–‹å§‹/çµ‚äº†ã€å…¨æ—¥ã€å ´æ‰€ã€ç´ä»˜ã‘ä¼æ¥­ã€ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆè¤‡æ•°å¯ï¼‰ã€Slack é€šçŸ¥ ON/OFFã€ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   - ä¿å­˜æ™‚ï¼šDB ä¿å­˜ â†’ notifications ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ â†’ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã«ç™»éŒ²
5. ES / è‡ªå·±åˆ†æã‚¨ãƒ‡ã‚£ã‚¿
   - ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ¿å…¥ã€æ·»ä»˜ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¿ã‚°ã€ä¼æ¥­ç´ä»˜ã‘ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ï¼ˆç°¡æ˜“ï¼‰
6. é¢æ¥ãƒãƒ¼ãƒˆ
   - æ—¥ä»˜ã€è³ªå•/å›ç­”ã‚’ç¹°è¿”ã—è¿½åŠ ã€è©•ä¾¡ã€æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€è©²å½“ã‚¤ãƒ™ãƒ³ãƒˆã¸ã®ãƒªãƒ³ã‚¯
7. é€šçŸ¥ç®¡ç†ç”»é¢
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§ï¼ˆpending/sent/failedï¼‰ã€æ‰‹å‹•å†é€ã€Slack è¨­å®šï¼ˆWebhook or OAuthï¼‰, ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®š
8. è¨­å®š
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€åŒæœŸè¨­å®šï¼ˆã‚ªãƒ³/ã‚ªãƒ•ï¼‰ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSON/CSVï¼‰ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€æ›´æ–°ãƒã‚§ãƒƒã‚¯

---

### ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼ˆSlackï¼‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ™‚ã« remind_before ã‚’è¨­å®šã—ã€Slack é€šçŸ¥ ON ã«ã™ã‚‹
2. ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜æ™‚ã« notifications ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ scheduled_at = start_at - remind_before ã‚’ä½œæˆ
3. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©å®Ÿè¡Œï¼ˆãƒ­ãƒ¼ã‚«ãƒ« or ã‚µãƒ¼ãƒãƒ¼ï¼‰
   - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ—ãƒªãŒå¸¸é§ã—ã¦ã„ã‚‹å ´åˆï¼šå†…è”µã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãŒ notifications ã‚’ç›£è¦–ã— scheduled_at åˆ°é”ã§ sendSlackNotification ã‚’å‘¼ã¶
   - ã‚µãƒ¼ãƒãƒ¼é‹ç”¨ã®å ´åˆï¼šã‚µãƒ¼ãƒãƒ¼ãŒé€šçŸ¥é€ä¿¡ã‚’ä»£è¡Œã—ã€é€ä¿¡çµæœã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã¸åŒæœŸ
4. Slack é€ä¿¡
   - æ¨å¥¨ï¼šSlack OAuth ã‚’ç”¨ã„ãŸ chat.postMessageï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã® workspace ã¨ãƒãƒ£ãƒãƒ«ã¸é€ä¿¡ï¼‰ã¾ãŸã¯ Incoming Webhookï¼ˆäº‹å‰ã«è¨­å®šæ¸ˆã¿ã®ãƒãƒ£ãƒ³ãƒãƒ«ï¼‰
   - é€ä¿¡ã®å†…å®¹ï¼šã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã€ä¼æ¥­åã€æ—¥æ™‚ã€å ´æ‰€ã€ãƒªãƒ³ã‚¯ï¼ˆã‚¢ãƒ—ãƒªå†…ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã¸ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹ deep linkï¼‰
5. é€ä¿¡çµæœã‚’ notifications.sent_at / status ã«è¨˜éŒ²ã€å¤±æ•—æ™‚ã¯å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰ã‚’å®Ÿè¡Œ

Slack ã®é¸æŠè‚¢
- Incoming Webhookï¼šç°¡æ½”ã ãŒå›ºå®šãƒãƒ£ãƒ³ãƒãƒ«å‘ã‘ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«Webhookã‚’ç®¡ç†ï¼‰
- Slack OAuth + chat.postMessageï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Slackã« DM ã§é€šçŸ¥ã€ã‚ˆã‚ŠæŸ”è»Ÿã§ UX è‰¯å¥½ï¼ˆæ¨å¥¨ï¼‰

---

### åŒæœŸãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³è¨­è¨ˆ
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼šã™ã¹ã¦ãƒ­ãƒ¼ã‚«ãƒ« DB ã§æ“ä½œå¯èƒ½
- åŒæœŸã‚­ãƒ¥ãƒ¼ï¼šå¤‰æ›´ã¯ sync_queue ã«ç©ã‚€ â†’ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å›å¾©æ™‚ã« /sync ã§ä¸€æ‹¬é€ä¿¡
- è¡çªè§£æ±ºï¼šæœ€å¾Œæ›´æ–°æ™‚åˆ»ï¼ˆlast_modifiedï¼‰ãƒ™ãƒ¼ã‚¹ã§è‡ªå‹•ãƒãƒ¼ã‚¸ã€é‡è¦ãªè¡çªã¯ UI ã§ç¢ºèªã•ã›ã‚‹

---

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
- èªè¨¼ï¼šOAuthï¼ˆå¤–éƒ¨ï¼‰ or ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆPBKDF2 / Argon2ï¼‰ï¼‹ JWTï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã†å ´åˆï¼‰
- Slack ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿è­·ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ OS ã‚­ãƒ¼ãƒªãƒ³ã‚°ï¼ˆWindows Credential Managerï¼‰ã«ä¿å­˜ã€ã‚µãƒ¼ãƒãƒ¼ã§ã¯æš—å·åŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- é€šä¿¡ï¼šTLSï¼ˆHTTPSï¼‰å›ºå®š
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ä¿è­·ï¼šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ DB æš—å·åŒ–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€è‡ªå‹•ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
- æ¨©é™ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ—ã§å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã« user_id ã‚’å¿…é ˆç´ä»˜ã‘

---

### é…å¸ƒãƒ»ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæˆ¦ç•¥
- ãƒ“ãƒ«ãƒ‰ï¼šElectron-builder ã§ MSIX / NSIS ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ç”Ÿæˆã€.NET ç‰ˆã¯ MSIX
- è‡ªå‹•æ›´æ–°ï¼šSquirrel / electron-updater ã‚’ä½¿ç”¨ã—ã¦å·®åˆ†ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹å¼ï¼šç¤¾å†…é…å¸ƒå‘ã‘ã« MSI / MSIXã€ä¸€èˆ¬é…å¸ƒã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ï¼ˆã‚µã‚¤ãƒ¬ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼šSlack é€£æºã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’ç”¨æ„ï¼ˆOAuth ã¾ãŸã¯ Webhook ç™»éŒ²ï¼‰

---

### ãƒ†ã‚¹ãƒˆè¨ˆç”»ã¨å“è³ªä¿è¨¼
- å˜ä½“ãƒ†ã‚¹ãƒˆï¼šå„ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€DB å±¤ã€é€šçŸ¥ãƒ­ã‚¸ãƒƒã‚¯
- çµåˆãƒ†ã‚¹ãƒˆï¼šã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ â†’ notifications ä½œæˆ â†’ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã§é€ä¿¡ â†’ Slack åˆ°é”ï¼ˆãƒ¢ãƒƒã‚¯ or ãƒ†ã‚¹ãƒˆ workspaceï¼‰
- E2E ãƒ†ã‚¹ãƒˆï¼šPlaywrightï¼ˆElectron å¯¾å¿œï¼‰ã§ä¸»è¦ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•æ¤œè¨¼
- UX ãƒ†ã‚¹ãƒˆï¼šå­¦ç”Ÿ 5ã€œ8 åã«ã‚ˆã‚‹ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ“ä½œã€ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆã€Slack å—ä¿¡ï¼‰
- ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆï¼šåŒæœŸ APIï¼ˆã‚µãƒ¼ãƒãƒ¼åˆ©ç”¨æ™‚ï¼‰ã®è² è·ç¢ºèª

---

### MVP ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆå„ªå…ˆåº¦ï¼‰
1. ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ï¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€ä¼æ¥­ CRUD  
2. ã‚¤ãƒ™ãƒ³ãƒˆ CRUDã€æœˆé–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ â†’ ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°  
3. ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼è¨­å®šã€notifications ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©  
4. Slack é€£æºï¼ˆWebhook ã¾ãŸã¯ OAuthï¼‰ã«ã‚ˆã‚‹é€šçŸ¥é€ä¿¡ï¼ˆãƒ†ã‚¹ãƒˆ Workspace ã¸ã®é€šçŸ¥ï¼‰  
5. ESãƒ»è‡ªå·±åˆ†æã® CRUDã€é¢æ¥ãƒãƒ¼ãƒˆï¼ˆåŸºæœ¬ï¼‰  
6. ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSON/CSVï¼‰ã€è¨­å®šç”»é¢ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ç”Ÿæˆ

---

### é–‹ç™ºã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç›®å®‰ãƒ»å°ãƒãƒ¼ãƒ ï¼‰
- è¨­è¨ˆç¢ºå®šï¼š1é€±  
- MVP å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºï¼š6ã€œ8é€±ï¼ˆ2äººãƒãƒ¼ãƒ ï¼šãƒ•ãƒ­ãƒ³ãƒˆ 1 / ãƒãƒƒã‚¯ 1ï¼‰  
  - é€±1-2ï¼šèªè¨¼ã€DB ãƒ¢ãƒ‡ãƒ«ã€ä¼æ¥­/ã‚¤ãƒ™ãƒ³ãƒˆ CRUDã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼åŸºç›¤  
  - é€±3-4ï¼šã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ UIã€é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã€Slack é€£æºå®Ÿè£…  
  - é€±5-6ï¼šES/è‡ªå·±åˆ†æ/é¢æ¥ãƒãƒ¼ãƒˆã€è¨­å®šã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€E2E ãƒ†ã‚¹ãƒˆ  
- ãƒ™ãƒ¼ã‚¿ â†’ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åæ˜ ï¼š2é€±  
- æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹æº–å‚™ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ»é…å¸ƒï¼‰1é€±

ç·è¨ˆï¼š10ã€œ12é€±é–“ï¼ˆMVP ã§ååˆ†ãªUXã¨å®‰å®šæ€§ã‚’ç›®æŒ‡ã™ï¼‰

---

### é‹ç”¨ä¸Šã®æ³¨æ„ç‚¹ & æ¨å¥¨
- Slacké€šçŸ¥ã®ä¿¡é ¼æ€§ç¢ºä¿ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒSlacké€£æºã‚’è§£é™¤ã™ã‚‹ã¨é€šçŸ¥å¤±æ•—ã«ãªã‚‹ãŸã‚ UI ã§é€£æºçŠ¶æ…‹ã‚’å¸¸æ™‚è¡¨ç¤ºã™ã‚‹ã€‚å¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ¡ãƒ¼ãƒ« or ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¹ãƒˆï¼‰ã‚’æ¤œè¨ã€‚
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ï¼šæ—¥æ™‚ã¯ UTC ã§ä¿å­˜ã—ã€è¡¨ç¤ºã¯ Windows ãƒ­ã‚±ãƒ¼ãƒ«ã«åˆã‚ã›ã‚‹ã€‚
- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼šESï¼è‡ªå·±åˆ†æã¯å€‹äººçš„ãƒ‡ãƒ¼ã‚¿ãªã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«æš—å·åŒ–ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ™‚ã®æ³¨æ„å–šè¨˜ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
- ç›£æŸ»ãƒ­ã‚°ï¼šé€šçŸ¥é€ä¿¡å±¥æ­´ã¨å¤±æ•—ãƒ­ã‚°ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç¢ºèªãƒ»å†é€ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

---

## ãƒ¡ãƒ¼ãƒ«ç®¡ç†æ©Ÿèƒ½ è©³ç´°è¨­è¨ˆ

### æ¦‚è¦
Gmail ã¨é€£æºã—ã€å—ä¿¡ãƒ¡ãƒ¼ãƒ«ã‚’ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ä¼æ¥­ã”ã¨ã«è‡ªå‹•ã§å‰²ã‚ŠæŒ¯ã‚‹æ©Ÿèƒ½ã€‚ãƒ¡ãƒ¼ãƒ«ãŒå±ŠããŸã³ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒèµ·å‹•ã—ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã£ã¦ä¼æ¥­ã«ç´ä»˜ã‘ã€ãã‚Œä»¥å¤–ã®ãƒ¡ãƒ¼ãƒ«ã¯æœªå‰²ã‚ŠæŒ¯ã‚ŠçŠ¶æ…‹ã§ä¿å­˜ã™ã‚‹ã€‚

### ç›®çš„
- å°±æ´»ãƒ¡ãƒ¼ãƒ«ï¼ˆé¸è€ƒæ¡ˆå†…ã€èª¬æ˜ä¼šé€šçŸ¥ã€çµæœé€£çµ¡ç­‰ï¼‰ã‚’ä¼æ¥­ã”ã¨ã«æ•´ç†
- ãƒ¡ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§é¸è€ƒçŠ¶æ³ã‚’è¿½è·¡å¯èƒ½ã«ã™ã‚‹
- æ‰‹å‹•ã§ä¼æ¥­ã«ç´ä»˜ã‘ã‚‹æ‰‹é–“ã‚’å‰Šæ¸›

---

### ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

#### 1. email_accounts ãƒ†ãƒ¼ãƒ–ãƒ«
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé€£æºã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç®¡ç†

```sql
CREATE TABLE email_accounts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  email_address TEXT NOT NULL UNIQUE,
  provider TEXT DEFAULT 'gmail',              -- 'gmail' (å°†æ¥çš„ã« 'outlook' ç­‰ã‚‚å¯)
  access_token TEXT,                          -- OAuth ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ (æš—å·åŒ–æ¨å¥¨)
  refresh_token TEXT,                         -- OAuth ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ (æš—å·åŒ–æ¨å¥¨)
  token_expires_at DATETIME,                  -- ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™
  last_sync_at DATETIME,                      -- æœ€çµ‚åŒæœŸæ—¥æ™‚
  sync_enabled BOOLEAN DEFAULT 1,             -- åŒæœŸæœ‰åŠ¹ãƒ•ãƒ©ã‚°
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

#### 2. email_messages ãƒ†ãƒ¼ãƒ–ãƒ«
å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«æœ¬ä½“

```sql
CREATE TABLE email_messages (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  email_account_id INTEGER NOT NULL,          -- ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆID
  message_id TEXT NOT NULL UNIQUE,            -- Gmail API ã® Message ID (é‡è¤‡é˜²æ­¢)
  thread_id TEXT,                             -- Gmail ã®ã‚¹ãƒ¬ãƒƒãƒ‰ID (é–¢é€£ãƒ¡ãƒ¼ãƒ«è¿½è·¡ç”¨)
  company_id INTEGER,                         -- å‰²ã‚ŠæŒ¯ã‚‰ã‚ŒãŸä¼æ¥­ID (NULL = æœªå‰²ã‚ŠæŒ¯ã‚Š)
  subject TEXT,                               -- ä»¶å
  from_address TEXT NOT NULL,                 -- é€ä¿¡å…ƒãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  from_name TEXT,                             -- é€ä¿¡å…ƒå
  to_address TEXT,                            -- å®›å…ˆ (ä¸»ã«è‡ªåˆ†ã®ã‚¢ãƒ‰ãƒ¬ã‚¹)
  cc_addresses TEXT,                          -- CC (JSONé…åˆ—å½¢å¼)
  body_text TEXT,                             -- ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæœ¬æ–‡
  body_html TEXT,                             -- HTMLæœ¬æ–‡
  received_at DATETIME NOT NULL,              -- å—ä¿¡æ—¥æ™‚ (Gmail ã®internalDate)
  is_read BOOLEAN DEFAULT 0,                  -- æ—¢èª­ãƒ•ãƒ©ã‚°
  is_starred BOOLEAN DEFAULT 0,               -- ã‚¹ã‚¿ãƒ¼ä»˜ããƒ•ãƒ©ã‚°
  labels TEXT,                                -- Gmail ãƒ©ãƒ™ãƒ« (JSONé…åˆ—)
  has_attachments BOOLEAN DEFAULT 0,          -- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ‰ç„¡
  attachments_metadata TEXT,                  -- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ± (JSON)
  allocation_method TEXT,                     -- å‰²ã‚ŠæŒ¯ã‚Šæ–¹æ³• ('auto', 'manual', null)
  allocated_at DATETIME,                      -- å‰²ã‚ŠæŒ¯ã‚Šæ—¥æ™‚
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (email_account_id) REFERENCES email_accounts(id) ON DELETE CASCADE,
  FOREIGN KEY (company_id) REFERENCES companies(id) ON DELETE SET NULL
);

CREATE INDEX idx_email_messages_company ON email_messages(company_id);
CREATE INDEX idx_email_messages_received ON email_messages(received_at DESC);
CREATE INDEX idx_email_messages_message_id ON email_messages(message_id);
```

#### 3. company_email_patterns ãƒ†ãƒ¼ãƒ–ãƒ«
ä¼æ¥­ã”ã¨ã®ãƒ¡ãƒ¼ãƒ«è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šãƒ«ãƒ¼ãƒ«

```sql
CREATE TABLE company_email_patterns (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  company_id INTEGER NOT NULL,
  pattern_type TEXT NOT NULL,                 -- 'domain', 'address', 'subject_keyword'
  pattern_value TEXT NOT NULL,                -- ãƒ‘ã‚¿ãƒ¼ãƒ³å€¤ (ä¾‹: '@example.com', 'noreply@company.com', 'é¸è€ƒ')
  priority INTEGER DEFAULT 0,                 -- å„ªå…ˆåº¦ (é«˜ã„å€¤ã»ã©å„ªå…ˆã€è¤‡æ•°ãƒãƒƒãƒæ™‚ã«ä½¿ç”¨)
  enabled BOOLEAN DEFAULT 1,                  -- æœ‰åŠ¹/ç„¡åŠ¹ãƒ•ãƒ©ã‚°
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (company_id) REFERENCES companies(id) ON DELETE CASCADE
);

CREATE INDEX idx_company_patterns_company ON company_email_patterns(company_id);
```

#### 4. email_sync_history ãƒ†ãƒ¼ãƒ–ãƒ«
åŒæœŸå±¥æ­´ã®è¨˜éŒ² (ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€ç›£æŸ»ç”¨)

```sql
CREATE TABLE email_sync_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  email_account_id INTEGER NOT NULL,
  sync_started_at DATETIME NOT NULL,
  sync_completed_at DATETIME,
  status TEXT DEFAULT 'running',              -- 'running', 'completed', 'failed'
  messages_fetched INTEGER DEFAULT 0,         -- å–å¾—ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°
  messages_allocated INTEGER DEFAULT 0,       -- è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°
  error_message TEXT,                         -- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (email_account_id) REFERENCES email_accounts(id) ON DELETE CASCADE
);
```

---

### Gmail API é€£æºãƒ•ãƒ­ãƒ¼

#### 1. OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼
  â†“ ã€ŒGmailã‚’é€£æºã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
Electron ã‚¢ãƒ—ãƒª
  â†“ ãƒ–ãƒ©ã‚¦ã‚¶ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ OAuth åŒæ„ç”»é¢ã‚’é–‹ã
  â†“ (ã‚¹ã‚³ãƒ¼ãƒ—: gmail.readonly ã¾ãŸã¯ gmail.modify)
Google OAuth Server
  â†“ èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™
Electron ã‚¢ãƒ—ãƒª
  â†“ èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
  â†“ access_token, refresh_token ã‚’å–å¾—
email_accounts ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ (Windows Credential Manager ã§æš—å·åŒ–)
```

**å¿…è¦ãª OAuth ã‚¹ã‚³ãƒ¼ãƒ—**:
- `https://www.googleapis.com/auth/gmail.readonly` (èª­ã¿å–ã‚Šå°‚ç”¨ã€æ¨å¥¨)
- ã¾ãŸã¯ `https://www.googleapis.com/auth/gmail.modify` (æ—¢èª­ãƒãƒ¼ã‚¯æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆ)

**ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†**:
- `access_token`: 1æ™‚é–“æœ‰åŠ¹ã€API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ä½¿ç”¨
- `refresh_token`: é•·æœŸæœ‰åŠ¹ã€access_token æ›´æ–°ã«ä½¿ç”¨
- ãƒˆãƒ¼ã‚¯ãƒ³ã¯ Windows Credential Manager ã«ä¿å­˜ã—ã€DB ã«ã¯æš—å·åŒ–ã‚­ãƒ¼ã®ã¿ä¿å­˜

#### 2. ãƒ¡ãƒ¼ãƒ«å—ä¿¡ç›£è¦–ãƒ•ãƒ­ãƒ¼ (Pushé€šçŸ¥æ–¹å¼)

Gmail API ã® **Pub/Sub é€šçŸ¥** ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ¡ãƒ¼ãƒ«å—ä¿¡æ™‚ã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å‡¦ç†ã‚’å®Ÿè¡Œã€‚

```
Gmail (ãƒ¡ãƒ¼ãƒ«å—ä¿¡)
  â†“ Pub/Sub é€šçŸ¥ (Google Cloud Pub/Sub)
  â†“
ãƒ­ãƒ¼ã‚«ãƒ« Webhook ã‚µãƒ¼ãƒãƒ¼ (Electron ã‚¢ãƒ—ãƒªå†…)
  ã¾ãŸã¯
ã‚¯ãƒ©ã‚¦ãƒ‰ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  â†“
Electron ã‚¢ãƒ—ãƒªã®åŒæœŸãƒˆãƒªã‚¬ãƒ¼
  â†“
fetchNewMessages() å®Ÿè¡Œ
```

**å®Ÿè£…æ–¹å¼ (2ã¤ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³)**:

##### ã‚ªãƒ—ã‚·ãƒ§ãƒ³A: ã‚¯ãƒ©ã‚¦ãƒ‰ä¸­ç¶™ã‚µãƒ¼ãƒãƒ¼çµŒç”± (æ¨å¥¨)
- Google Pub/Sub â†’ ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒãƒ¼ â†’ Electron ã‚¢ãƒ—ãƒªã¸ WebSocket/Polling ã§é€šçŸ¥
- ãƒ¡ãƒªãƒƒãƒˆ: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ãªãã¦ã‚‚åŒæœŸå¯èƒ½ã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«å•é¡Œãªã—
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: ã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰ãŒå¿…è¦

##### ã‚ªãƒ—ã‚·ãƒ§ãƒ³B: ãƒ­ãƒ¼ã‚«ãƒ« Polling æ–¹å¼ (ã‚·ãƒ³ãƒ—ãƒ«)
- Electron ã‚¢ãƒ—ãƒªãŒå®šæœŸçš„ã« Gmail API ã‚’ Polling (ä¾‹: 5åˆ†ã”ã¨)
- ãƒ¡ãƒªãƒƒãƒˆ: ã‚µãƒ¼ãƒãƒ¼ä¸è¦ã€å®Ÿè£…ãŒç°¡å˜
- ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒä½ã„ã€API ã‚¯ã‚©ãƒ¼ã‚¿æ¶ˆè²»

**æ¨å¥¨**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³B (Polling) ã‹ã‚‰é–‹å§‹ã—ã€å¿…è¦ã«å¿œã˜ã¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³Aã«ç§»è¡Œ

#### 3. ãƒ¡ãƒ¼ãƒ«å–å¾—ã¨è§£æãƒ•ãƒ­ãƒ¼

```javascript
// ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
async function fetchNewMessages(emailAccountId) {
  const account = await getEmailAccount(emailAccountId);

  // 1. æœ€çµ‚åŒæœŸæ—¥æ™‚ä»¥é™ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
  const query = `after:${account.last_sync_at.toUnixTime()}`;
  const messages = await gmailAPI.users.messages.list({
    userId: 'me',
    q: query,
    maxResults: 100
  });

  // 2. å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è©³ç´°ã‚’å–å¾—
  for (const message of messages.data.messages) {
    const detail = await gmailAPI.users.messages.get({
      userId: 'me',
      id: message.id,
      format: 'full'  // ãƒ˜ãƒƒãƒ€ãƒ¼ + æœ¬æ–‡
    });

    // 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è§£æã—ã¦ DB ã«ä¿å­˜
    const emailData = parseGmailMessage(detail);
    await saveEmailMessage(emailData);

    // 4. è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šã‚’å®Ÿè¡Œ
    await allocateEmailToCompany(emailData.id);
  }

  // 5. æœ€çµ‚åŒæœŸæ—¥æ™‚ã‚’æ›´æ–°
  await updateLastSyncAt(emailAccountId, new Date());
}
```

#### 4. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£æãƒ­ã‚¸ãƒƒã‚¯

```javascript
function parseGmailMessage(gmailMessage) {
  const headers = gmailMessage.payload.headers;
  const getHeader = (name) => headers.find(h => h.name.toLowerCase() === name.toLowerCase())?.value;

  return {
    message_id: gmailMessage.id,
    thread_id: gmailMessage.threadId,
    subject: getHeader('Subject'),
    from_address: extractEmail(getHeader('From')),
    from_name: extractName(getHeader('From')),
    to_address: getHeader('To'),
    received_at: new Date(parseInt(gmailMessage.internalDate)),
    body_text: extractTextBody(gmailMessage.payload),
    body_html: extractHtmlBody(gmailMessage.payload),
    labels: gmailMessage.labelIds,
    has_attachments: hasAttachments(gmailMessage.payload)
  };
}
```

---

### ãƒ¡ãƒ¼ãƒ«è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šãƒ­ã‚¸ãƒƒã‚¯

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã®å„ªå…ˆé †ä½

```javascript
async function allocateEmailToCompany(emailMessageId) {
  const email = await getEmailMessage(emailMessageId);

  // ã™ã§ã«å‰²ã‚ŠæŒ¯ã‚Šæ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (email.company_id) return;

  // 1. é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹å®Œå…¨ä¸€è‡´ (æœ€å„ªå…ˆ)
  let company = await findCompanyByPattern('address', email.from_address);

  // 2. é€ä¿¡å…ƒãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€è‡´
  if (!company) {
    const domain = extractDomain(email.from_address);  // '@example.com'
    company = await findCompanyByPattern('domain', domain);
  }

  // 3. ä»¶åã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¸€è‡´
  if (!company && email.subject) {
    company = await findCompanyByPatternInSubject(email.subject);
  }

  // 4. ãƒãƒƒãƒã—ãŸå ´åˆã¯å‰²ã‚ŠæŒ¯ã‚Š
  if (company) {
    await updateEmailMessage(emailMessageId, {
      company_id: company.id,
      allocation_method: 'auto',
      allocated_at: new Date()
    });
  }

  // ãƒãƒƒãƒã—ãªã„å ´åˆã¯æœªå‰²ã‚ŠæŒ¯ã‚Š (company_id = NULL) ã®ã¾ã¾
}

async function findCompanyByPattern(patternType, value) {
  const patterns = await db.query(`
    SELECT company_id, priority
    FROM company_email_patterns
    WHERE pattern_type = ? AND pattern_value = ? AND enabled = 1
    ORDER BY priority DESC
    LIMIT 1
  `, [patternType, value]);

  if (patterns.length > 0) {
    return await getCompanyById(patterns[0].company_id);
  }
  return null;
}
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³ç¨®åˆ¥ã®è©³ç´°

| pattern_type | pattern_value ã®ä¾‹ | ãƒãƒƒãƒãƒ³ã‚°æ¡ä»¶ |
|---|---|---|
| `address` | `noreply@company.com` | `from_address` ã¨å®Œå…¨ä¸€è‡´ |
| `domain` | `@company.com` | `from_address` ãŒè©²å½“ãƒ‰ãƒ¡ã‚¤ãƒ³ã§çµ‚ã‚ã‚‹ |
| `subject_keyword` | `é¸è€ƒ`, `é¢æ¥` | `subject` ã«è©²å½“ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ |

#### è¤‡æ•°ãƒãƒƒãƒæ™‚ã®å‡¦ç†
- `priority` ãŒé«˜ã„æ–¹ã‚’å„ªå…ˆ
- åŒã˜ priority ã®å ´åˆã¯ `pattern_type` ã®å„ªå…ˆé †ä½ã§æ±ºå®š (address > domain > subject_keyword)

---

### ãƒªãƒã‚¸ãƒˆãƒªå±¤ (Repository Pattern)

#### EmailAccountRepository
```typescript
// src/database/repositories/emailAccountRepository.ts
export class EmailAccountRepository {
  create(data: CreateEmailAccountData): EmailAccount;
  findById(id: number): EmailAccount | undefined;
  findByUserId(userId: number): EmailAccount[];
  findByEmail(email: string): EmailAccount | undefined;
  updateTokens(id: number, tokens: TokenData): EmailAccount;
  updateLastSyncAt(id: number, timestamp: Date): void;
  updateSyncEnabled(id: number, enabled: boolean): void;
  delete(id: number): boolean;
}
```

#### EmailMessageRepository
```typescript
// src/database/repositories/emailMessageRepository.ts
export class EmailMessageRepository {
  create(data: CreateEmailMessageData): EmailMessage;
  findById(id: number): EmailMessage | undefined;
  findByMessageId(messageId: string): EmailMessage | undefined;
  findByCompanyId(companyId: number, options?: PaginationOptions): EmailMessage[];
  findUnallocated(emailAccountId: number, options?: PaginationOptions): EmailMessage[];
  findByDateRange(start: Date, end: Date): EmailMessage[];
  updateCompanyAllocation(id: number, companyId: number | null, method: 'auto' | 'manual'): void;
  updateReadStatus(id: number, isRead: boolean): void;
  search(emailAccountId: number, query: string): EmailMessage[];
  delete(id: number): boolean;
}
```

#### CompanyEmailPatternRepository
```typescript
// src/database/repositories/companyEmailPatternRepository.ts
export class CompanyEmailPatternRepository {
  create(data: CreatePatternData): CompanyEmailPattern;
  findById(id: number): CompanyEmailPattern | undefined;
  findByCompanyId(companyId: number): CompanyEmailPattern[];
  findMatchingPattern(patternType: string, value: string): CompanyEmailPattern[];
  update(id: number, data: UpdatePatternData): CompanyEmailPattern;
  delete(id: number): boolean;
  toggleEnabled(id: number, enabled: boolean): void;
}
```

---

### ã‚µãƒ¼ãƒ“ã‚¹å±¤ (Service Pattern)

#### EmailService
ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã¨åŒæœŸå‡¦ç†

```typescript
// src/main/services/emailService.ts
export class EmailService {
  private emailAccountRepo: EmailAccountRepository;
  private emailMessageRepo: EmailMessageRepository;
  private gmailClient: GmailClient;

  // OAuth èªè¨¼
  async authenticateGmail(authCode: string, userId: number): Promise<Result<EmailAccount>>;

  // ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
  async refreshAccessToken(emailAccountId: number): Promise<Result<void>>;

  // ãƒ¡ãƒ¼ãƒ«åŒæœŸ
  async syncEmails(emailAccountId: number): Promise<Result<SyncResult>>;

  // ç‰¹å®šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—
  async getEmailMessage(id: number): Promise<Result<EmailMessage>>;

  // ä¼æ¥­åˆ¥ãƒ¡ãƒ¼ãƒ«å–å¾—
  async getEmailsByCompany(companyId: number, pagination?: PaginationOptions): Promise<Result<EmailMessage[]>>;

  // æœªå‰²ã‚ŠæŒ¯ã‚Šãƒ¡ãƒ¼ãƒ«å–å¾—
  async getUnallocatedEmails(emailAccountId: number, pagination?: PaginationOptions): Promise<Result<EmailMessage[]>>;

  // æ—¢èª­ç®¡ç†
  async markAsRead(id: number): Promise<Result<void>>;

  // æ¤œç´¢
  async searchEmails(emailAccountId: number, query: string): Promise<Result<EmailMessage[]>>;
}
```

#### EmailAllocationService
ãƒ¡ãƒ¼ãƒ«å‰²ã‚ŠæŒ¯ã‚Šãƒ­ã‚¸ãƒƒã‚¯

```typescript
// src/main/services/emailAllocationService.ts
export class EmailAllocationService {
  private emailMessageRepo: EmailMessageRepository;
  private patternRepo: CompanyEmailPatternRepository;

  // è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šå®Ÿè¡Œ
  async allocateEmail(emailMessageId: number): Promise<Result<Company | null>>;

  // æ‰‹å‹•å‰²ã‚ŠæŒ¯ã‚Š
  async manuallyAllocate(emailMessageId: number, companyId: number): Promise<Result<void>>;

  // å‰²ã‚ŠæŒ¯ã‚Šè§£é™¤
  async unallocate(emailMessageId: number): Promise<Result<void>>;

  // ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
  async addPattern(companyId: number, patternData: PatternData): Promise<Result<CompanyEmailPattern>>;
  async removePattern(patternId: number): Promise<Result<void>>;
  async getPatterns(companyId: number): Promise<Result<CompanyEmailPattern[]>>;

  // ä¸€æ‹¬å†å‰²ã‚ŠæŒ¯ã‚Š (ãƒ‘ã‚¿ãƒ¼ãƒ³å¤‰æ›´å¾Œã«å®Ÿè¡Œ)
  async reallocateAllEmails(emailAccountId: number): Promise<Result<ReallocateResult>>;
}
```

#### GmailClient (Gmail API ãƒ©ãƒƒãƒ‘ãƒ¼)
```typescript
// src/main/services/gmailClient.ts
export class GmailClient {
  private oauth2Client: OAuth2Client;

  constructor(tokens: TokenData) {
    this.oauth2Client = new google.auth.OAuth2(CLIENT_ID, CLIENT_SECRET);
    this.oauth2Client.setCredentials(tokens);
  }

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆå–å¾—
  async listMessages(query: string, maxResults?: number): Promise<GmailMessage[]>;

  // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è©³ç´°å–å¾—
  async getMessage(messageId: string): Promise<GmailMessageDetail>;

  // æ—¢èª­ãƒãƒ¼ã‚¯ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  async markAsRead(messageId: string): Promise<void>;

  // ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
  async refreshToken(refreshToken: string): Promise<TokenData>;
}
```

---

### IPC ãƒãƒ³ãƒ‰ãƒ© (Main Process)

```typescript
// src/main/main.ts ã® registerIpcHandlers() å†…ã«è¿½åŠ 

// ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
ipcMain.handle('email:authenticate', async (_event, authCode, userId) => {
  return emailService.authenticateGmail(authCode, userId);
});

ipcMain.handle('email:getAccounts', async (_event, userId) => {
  return emailService.getAccountsByUserId(userId);
});

ipcMain.handle('email:syncNow', async (_event, emailAccountId) => {
  return emailService.syncEmails(emailAccountId);
});

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—
ipcMain.handle('email:getByCompany', async (_event, companyId, pagination) => {
  return emailService.getEmailsByCompany(companyId, pagination);
});

ipcMain.handle('email:getUnallocated', async (_event, emailAccountId, pagination) => {
  return emailService.getUnallocatedEmails(emailAccountId, pagination);
});

ipcMain.handle('email:getMessage', async (_event, id) => {
  return emailService.getEmailMessage(id);
});

ipcMain.handle('email:markAsRead', async (_event, id) => {
  return emailService.markAsRead(id);
});

ipcMain.handle('email:search', async (_event, emailAccountId, query) => {
  return emailService.searchEmails(emailAccountId, query);
});

// ãƒ¡ãƒ¼ãƒ«å‰²ã‚ŠæŒ¯ã‚Š
ipcMain.handle('email:allocate', async (_event, emailMessageId, companyId) => {
  return emailAllocationService.manuallyAllocate(emailMessageId, companyId);
});

ipcMain.handle('email:unallocate', async (_event, emailMessageId) => {
  return emailAllocationService.unallocate(emailMessageId);
});

// ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†
ipcMain.handle('email:addPattern', async (_event, companyId, patternData) => {
  return emailAllocationService.addPattern(companyId, patternData);
});

ipcMain.handle('email:getPatterns', async (_event, companyId) => {
  return emailAllocationService.getPatterns(companyId);
});

ipcMain.handle('email:removePattern', async (_event, patternId) => {
  return emailAllocationService.removePattern(patternId);
});

ipcMain.handle('email:reallocateAll', async (_event, emailAccountId) => {
  return emailAllocationService.reallocateAllEmails(emailAccountId);
});
```

---

### UI å±¤ (Renderer Process)

#### 1. ãƒ¡ãƒ¼ãƒ«ç®¡ç†ãƒšãƒ¼ã‚¸ (EmailsPage.tsx)

**ä¸»è¦æ©Ÿèƒ½**:
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ: ã€Œå…¨ãƒ¡ãƒ¼ãƒ«ã€ã€Œä¼æ¥­åˆ¥ã€ã€Œæœªå‰²ã‚ŠæŒ¯ã‚Šã€
- ãƒ¡ãƒ¼ãƒ«ä¸€è¦§è¡¨ç¤º (ã‚«ãƒ¼ãƒ‰å½¢å¼ or ãƒªã‚¹ãƒˆå½¢å¼)
- æ¤œç´¢ãƒãƒ¼
- åŒæœŸãƒœã‚¿ãƒ³ã€æœ€çµ‚åŒæœŸæ—¥æ™‚è¡¨ç¤º
- ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¡ãƒ¼ãƒ«ç®¡ç†              [åŒæœŸ] [è¨­å®š]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å…¨ãƒ¡ãƒ¼ãƒ«] [ä¼æ¥­åˆ¥] [æœªå‰²ã‚ŠæŒ¯ã‚Š]                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¤œç´¢: [_________________________] [ğŸ”]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ ãƒ¡ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ“§ ã€æ ªå¼ä¼šç¤¾Exampleã€‘ä¸€æ¬¡é¢æ¥ã®ã”æ¡ˆå†…      â”‚    â”‚
â”‚ â”‚ from: recruit@example.com                  â”‚    â”‚
â”‚ â”‚ 2024-01-15 10:30                          â”‚    â”‚
â”‚ â”‚ å‰²ã‚ŠæŒ¯ã‚Š: æ ªå¼ä¼šç¤¾Example                   â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€ ãƒ¡ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ“§ èª¬æ˜ä¼šå‚åŠ ã®ãŠç¤¼                         â”‚    â”‚
â”‚ â”‚ from: noreply@company.jp                   â”‚    â”‚
â”‚ â”‚ 2024-01-14 18:20                          â”‚    â”‚
â”‚ â”‚ å‰²ã‚ŠæŒ¯ã‚Š: [æœªå‰²ã‚ŠæŒ¯ã‚Š] [ä¼æ¥­ã«ç´ä»˜ã‘]        â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ãƒ¡ãƒ¼ãƒ«è©³ç´°ãƒ€ã‚¤ã‚¢ãƒ­ã‚° (EmailDetailDialog.tsx)

**è¡¨ç¤ºå†…å®¹**:
- ä»¶åã€é€ä¿¡å…ƒã€å®›å…ˆã€CCã€å—ä¿¡æ—¥æ™‚
- æœ¬æ–‡ (HTML or ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ)
- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ
- å‰²ã‚ŠæŒ¯ã‚Šä¼æ¥­ (å¤‰æ›´å¯èƒ½)
- æ—¢èª­/æœªèª­åˆ‡ã‚Šæ›¿ãˆ
- é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆãƒ»ESã¸ã®ãƒªãƒ³ã‚¯ (è©²å½“ä¼æ¥­ã®æƒ…å ±)

#### 3. ä¼æ¥­è©³ç´°ãƒšãƒ¼ã‚¸ã«ã€Œãƒ¡ãƒ¼ãƒ«ã€ã‚¿ãƒ–ã‚’è¿½åŠ 

**CompanyDetailPage.tsx ã®æ‹¡å¼µ**:
- ã‚¿ãƒ–: æ¦‚è¦ / ã‚¤ãƒ™ãƒ³ãƒˆ / ES / é¢æ¥ãƒãƒ¼ãƒˆ / **ãƒ¡ãƒ¼ãƒ«** (æ–°è¦)
- ãƒ¡ãƒ¼ãƒ«ã‚¿ãƒ–:
  - è©²å½“ä¼æ¥­ã«å‰²ã‚ŠæŒ¯ã‚‰ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ä¸€è¦§
  - ãƒ¡ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šãƒœã‚¿ãƒ³
  - è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šãƒ«ãƒ¼ãƒ«è¡¨ç¤ºãƒ»ç·¨é›†

#### 4. ãƒ¡ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚° (EmailPatternDialog.tsx)

**UI**:
```
â”Œâ”€ ãƒ¡ãƒ¼ãƒ«è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šãƒ«ãƒ¼ãƒ« (æ ªå¼ä¼šç¤¾Example) â”€â”€â”
â”‚ ãƒ«ãƒ¼ãƒ«ä¸€è¦§:                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ 1. ãƒ‰ãƒ¡ã‚¤ãƒ³: @example.com  å„ªå…ˆåº¦: 10  â”‚  â”‚
â”‚ â”‚    [æœ‰åŠ¹] [ç·¨é›†] [å‰Šé™¤]                 â”‚  â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚ 2. ã‚¢ãƒ‰ãƒ¬ã‚¹: recruit@example.com       â”‚  â”‚
â”‚ â”‚    å„ªå…ˆåº¦: 20  [æœ‰åŠ¹] [ç·¨é›†] [å‰Šé™¤]     â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ [+ æ–°ã—ã„ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ]                        â”‚
â”‚                                              â”‚
â”‚ [ä¸€æ‹¬å†å‰²ã‚ŠæŒ¯ã‚Šå®Ÿè¡Œ] [é–‰ã˜ã‚‹]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5. Gmail é€£æºè¨­å®š (SettingsPage.tsx ã«è¿½åŠ )

**ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:
- é€£æºæ¸ˆã¿ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º
- ã€ŒGmail ã‚’é€£æºã€ãƒœã‚¿ãƒ³
- åŒæœŸé »åº¦è¨­å®š (æ‰‹å‹• / 5åˆ†ã”ã¨ / 10åˆ†ã”ã¨ / 30åˆ†ã”ã¨)
- è‡ªå‹•åŒæœŸ ON/OFF
- åŒæœŸå±¥æ­´è¡¨ç¤º

---

### ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ (å®šæœŸåŒæœŸ)

```typescript
// src/main/services/emailSchedulerService.ts
import cron from 'node-cron';

export class EmailSchedulerService {
  private jobs: Map<number, cron.ScheduledTask> = new Map();

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¨ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åŒæœŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç™»éŒ²
  startSyncScheduler(userId: number, intervalMinutes: number = 10) {
    const accounts = await emailAccountRepo.findByUserId(userId);

    accounts.forEach(account => {
      if (account.sync_enabled) {
        // Cron å¼: æŒ‡å®šåˆ†ã”ã¨ã«å®Ÿè¡Œ
        const cronExpression = `*/${intervalMinutes} * * * *`;

        const job = cron.schedule(cronExpression, async () => {
          console.log(`[Email Sync] Starting sync for account ${account.id}`);
          await emailService.syncEmails(account.id);
        });

        this.jobs.set(account.id, job);
      }
    });
  }

  stopSyncScheduler(emailAccountId: number) {
    const job = this.jobs.get(emailAccountId);
    if (job) {
      job.stop();
      this.jobs.delete(emailAccountId);
    }
  }

  restartAll(userId: number, intervalMinutes: number) {
    this.stopAll(userId);
    this.startSyncScheduler(userId, intervalMinutes);
  }
}
```

**ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®åˆæœŸåŒ–**:
```typescript
// src/main/main.ts
app.on('ready', async () => {
  // ... æ—¢å­˜ã®åˆæœŸåŒ–å‡¦ç†

  // ãƒ¡ãƒ¼ãƒ«åŒæœŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼èµ·å‹•
  const user = await authService.getCurrentUser();
  if (user) {
    const syncInterval = user.settings?.email_sync_interval || 10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ10åˆ†
    emailSchedulerService.startSyncScheduler(user.id, syncInterval);
  }
});
```

---

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

#### 1. ãƒˆãƒ¼ã‚¯ãƒ³ã®æš—å·åŒ–ä¿å­˜

```typescript
// Windows Credential Manager ã‚’ä½¿ç”¨
import keytar from 'keytar';

async function saveTokens(emailAccountId: number, tokens: TokenData) {
  const serviceName = 'CareerManagerApp';
  const accountName = `email_account_${emailAccountId}`;

  await keytar.setPassword(serviceName, accountName, JSON.stringify(tokens));
}

async function getTokens(emailAccountId: number): Promise<TokenData | null> {
  const serviceName = 'CareerManagerApp';
  const accountName = `email_account_${emailAccountId}`;

  const tokensJson = await keytar.getPassword(serviceName, accountName);
  return tokensJson ? JSON.parse(tokensJson) : null;
}
```

#### 2. OAuth ã‚¹ã‚³ãƒ¼ãƒ—ã®æœ€å°åŒ–
- å¯èƒ½ãªé™ã‚Š `gmail.readonly` ã‚’ä½¿ç”¨
- æ—¢èª­ãƒãƒ¼ã‚¯æ©Ÿèƒ½ãŒå¿…é ˆã§ãªã„é™ã‚Šã€æ›¸ãè¾¼ã¿æ¨©é™ã¯ä¸è¦

#### 3. API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åˆ¶é™
- Gmail API ã®ã‚¯ã‚©ãƒ¼ã‚¿: 1æ—¥ã‚ãŸã‚Š 10å„„ãƒªã‚¯ã‚¨ã‚¹ãƒˆ (é€šå¸¸ã¯å•é¡Œãªã—)
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 1ç§’ã‚ãŸã‚Š 25ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- å®Ÿè£…: ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ (æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•) ã‚’çµ„ã¿è¾¼ã‚€

---

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### ä¸»è¦ãªã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | å¯¾å‡¦ |
|---|---|---|
| `invalid_grant` | refresh_token ãŒç„¡åŠ¹ | å†èªè¨¼ã‚’ä¿ƒã™ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| `insufficient_permissions` | OAuth ã‚¹ã‚³ãƒ¼ãƒ—ä¸è¶³ | å†èªè¨¼ã§æ­£ã—ã„ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¦æ±‚ |
| `quotaExceeded` | API ã‚¯ã‚©ãƒ¼ã‚¿è¶…é | åŒæœŸé »åº¦ã‚’ä¸‹ã’ã‚‹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ |
| `backendError` | Gmail API ä¸€æ™‚ã‚¨ãƒ©ãƒ¼ | ãƒªãƒˆãƒ©ã‚¤ (æœ€å¤§3å›ã€æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•) |

#### ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãƒ•ãƒ­ãƒ¼
```typescript
// ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚
emailService.syncEmails(accountId)
  .catch(error => {
    if (error.code === 'invalid_grant') {
      // UI ã«é€šçŸ¥ã—ã¦å†èªè¨¼ã‚’ä¿ƒã™
      notificationService.notify(userId, {
        type: 'error',
        title: 'Gmail é€£æºã‚¨ãƒ©ãƒ¼',
        message: 'å†åº¦ Gmail ã‚’é€£æºã—ã¦ãã ã•ã„',
        action: 'reauthenticate'
      });
    }
  });
```

---

### ãƒ†ã‚¹ãƒˆè¨ˆç”»

#### 1. å˜ä½“ãƒ†ã‚¹ãƒˆ
- Repository å±¤ã®CRUDæ“ä½œ
- ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£æé–¢æ•°

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆ
- Gmail API ãƒ¢ãƒƒã‚¯ä½¿ç”¨
- åŒæœŸãƒ•ãƒ­ãƒ¼å…¨ä½“ã®ãƒ†ã‚¹ãƒˆ
- è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šã®æ¤œè¨¼

#### 3. E2Eãƒ†ã‚¹ãƒˆ
- OAuth èªè¨¼ãƒ•ãƒ­ãƒ¼ (ãƒ†ã‚¹ãƒˆç”¨ Google ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)
- ãƒ¡ãƒ¼ãƒ«åŒæœŸã¨è¡¨ç¤º
- æ‰‹å‹•å‰²ã‚ŠæŒ¯ã‚Šæ“ä½œ

---

### MVP ã‚¹ã‚³ãƒ¼ãƒ— (ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½)

#### Phase 1: åŸºæœ¬æ©Ÿèƒ½
1. Gmail OAuth èªè¨¼
2. ãƒ¡ãƒ¼ãƒ«åŒæœŸ (Polling æ–¹å¼ã€10åˆ†é–“éš”)
3. ãƒ¡ãƒ¼ãƒ«ä¸€è¦§è¡¨ç¤º (å…¨ãƒ¡ãƒ¼ãƒ«)
4. ãƒ¡ãƒ¼ãƒ«è©³ç´°è¡¨ç¤º
5. æ‰‹å‹•ã§ã®ä¼æ¥­ã¸ã®å‰²ã‚ŠæŒ¯ã‚Š

#### Phase 2: è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Š
6. ãƒ‘ã‚¿ãƒ¼ãƒ³ç®¡ç†UI (ãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚¢ãƒ‰ãƒ¬ã‚¹)
7. è‡ªå‹•å‰²ã‚ŠæŒ¯ã‚Šãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
8. æœªå‰²ã‚ŠæŒ¯ã‚Šãƒ¡ãƒ¼ãƒ«è¡¨ç¤º
9. ä¼æ¥­è©³ç´°ãƒšãƒ¼ã‚¸ã®ãƒ¡ãƒ¼ãƒ«ã‚¿ãƒ–

#### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½
10. ä»¶åã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³
11. ä¸€æ‹¬å†å‰²ã‚ŠæŒ¯ã‚Š
12. ãƒ¡ãƒ¼ãƒ«æ¤œç´¢
13. æ—¢èª­ç®¡ç† (Gmail API æ›¸ãè¾¼ã¿æ¨©é™ãŒå¿…è¦)

---

### é–‹ç™ºã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« (ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½ã®ã¿)

- Phase 1 å®Ÿè£…: 2é€±é–“
- Phase 2 å®Ÿè£…: 1.5é€±é–“
- Phase 3 å®Ÿè£…: 1é€±é–“
- ãƒ†ã‚¹ãƒˆãƒ»ãƒã‚°ä¿®æ­£: 1é€±é–“

**åˆè¨ˆ: 5.5é€±é–“**

---

### é‹ç”¨ä¸Šã®æ³¨æ„ç‚¹ (ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½)

#### Gmail API ã‚¯ã‚©ãƒ¼ã‚¿ç®¡ç†
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¯ã‚©ãƒ¼ã‚¿ã¯ååˆ†ã ãŒã€å¤šæ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚åˆ©ç”¨ã™ã‚‹å ´åˆã¯ç›£è¦–ãŒå¿…è¦
- ã‚¯ã‚©ãƒ¼ã‚¿è¶…éæ™‚ã¯åŒæœŸé »åº¦ã‚’è‡ªå‹•çš„ã«ä¸‹ã’ã‚‹

#### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
- ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã¯æš—å·åŒ–ã›ãšå¹³æ–‡ã§ä¿å­˜ (ãƒ­ãƒ¼ã‚«ãƒ«DB)
- å°†æ¥çš„ã«DBå…¨ä½“ã®æš—å·åŒ–ã‚’æ¤œè¨ (SQLCipher ç­‰)

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- åˆå›åŒæœŸæ™‚ã¯éå»30æ—¥åˆ†ã®ã¿å–å¾— (è¨­å®šå¯èƒ½)
- å¤§é‡ãƒ¡ãƒ¼ãƒ« (1000ä»¶ä»¥ä¸Š) ã®å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆ
- é€£æºã‚¨ãƒ©ãƒ¼æ™‚ã®å†èªè¨¼æ‰‹é †ã‚’æ˜ç¢ºã«æ¡ˆå†…
- åŒæœŸå±¥æ­´ã‚’ UI ã§ç¢ºèªå¯èƒ½ã«ã™ã‚‹

---
